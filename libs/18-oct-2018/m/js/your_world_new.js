


var ver = '31jul2018';


var yw_custom_from_spread = {
  "version":"1.0",
  "encoding":"UTF-8",
  "feed":{
    "xmlns":"http://www.w3.org/2005/Atom",
    "xmlns$openSearch":"http://a9.com/-/spec/opensearchrss/1.0/",
    "xmlns$gsx":"http://schemas.google.com/spreadsheets/2006/extended",
    "id":{
      "$t":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values"
    },
    "updated":{
      "$t":"2018-08-20T22:38:25.668Z"
    },
    "category":[
      {
          "scheme":"http://schemas.google.com/spreadsheets/2006",
          "term":"http://schemas.google.com/spreadsheets/2006#list"
      }
    ],
    "title":{
      "type":"text",
      "$t":"Sheet1"
    },
    "link":[
      {
          "rel":"alternate",
          "type":"application/atom+xml",
          "href":"https://docs.google.com/a/xsolla.com/spreadsheets/d/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/pubhtml"
      },
      {
          "rel":"http://schemas.google.com/g/2005#feed",
          "type":"application/atom+xml",
          "href":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values"
      },
      {
          "rel":"http://schemas.google.com/g/2005#post",
          "type":"application/atom+xml",
          "href":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values"
      },
      {
          "rel":"self",
          "type":"application/atom+xml",
          "href":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values?alt\u003djson"
      }
    ],
    "author":[
      {
          "name":{
            "$t":"m.miroshnikov"
          },
          "email":{
            "$t":"m.miroshnikov@xsolla.com"
          }
      }
    ],
    "openSearch$totalResults":{
      "$t":"1"
    },
    "openSearch$startIndex":{
      "$t":"1"
    },
    "entry":[
      {
          "id":{
            "$t":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values/cokwr"
          },
          "updated":{
            "$t":"2018-08-20T22:38:25.668Z"
          },
          "category":[
            {
                "scheme":"http://schemas.google.com/spreadsheets/2006",
                "term":"http://schemas.google.com/spreadsheets/2006#list"
            }
          ],
          "title":{
            "type":"text",
            "$t":"http://24.media.tumblr.com/tumblr_m0qjvo7vVy1r0l5jyo1_500.gif'"
          },
          "content":{
            "type":"text",
            "$t":""
          },
          "link":[
            {
                "rel":"self",
                "type":"application/atom+xml",
                "href":"https://spreadsheets.google.com/feeds/list/117bfh_YEebxcA7QpxFpRyi3MdNvnbbT42xr__U8MfEY/od6/public/values/cokwr"
            }
          ],
          "gsx$imageurlcustom":{
            "$t":"http://24.media.tumblr.com/tumblr_m0qjvo7vVy1r0l5jyo1_500.gif'"
          }
      }
    ]
  }
}



var yw_custom_attributes = {
  'ugc_test3': {
    'image_url_custom': 'http://24.media.tumblr.com/tumblr_m0qjvo7vVy1r0l5jyo1_500.gif',
    'image_url_custom_hover': 'https://daks2k3a4ib2z.cloudfront.net/5a03819163f9620001c8ecbe/5a0eb604541771000181c5a6_Tier1_GIF_1.gif',
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating xyw_rating--empty">star_border</div><div class="xyw_rating xyw_rating--empty">star_border</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  },
  'ugc_test2': {
    'image_url_custom': 'https://uploads-ssl.webflow.com/59c9e6e7fcfbf30001973a4f/59cca2b5172d780001e889ff_Mtn_3.jpg',
    'image_url_custom_hover': 'https://daks2k3a4ib2z.cloudfront.net/5a03819163f9620001c8ecbe/5a0eb6054d8d810001dff53d_Tier2_GIF_1.gif',
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating xyw_rating--empty">star_border</div><div class="xyw_rating xyw_rating--empty">star_border</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  },
  'ugc_test1': {
    'image_url_custom': 'https://media.giphy.com/media/SaGDxw6GK978s/giphy.gif',
    'image_url_custom_hover': 'https://daks2k3a4ib2z.cloudfront.net/5a03819163f9620001c8ecbe/5a0eb6ce541771000181c659_Tier3_GIF_1.gif',
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating xyw_rating--empty">star_border</div><div class="xyw_rating xyw_rating--empty">star_border</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  },
  'ugc_test6': {
    'image_url_custom': 'https://media.giphy.com/media/emcAG2mTrfbB6/source.gif',
    'image_url_custom_hover': 'https://media.giphy.com/media/SaGDxw6GK978s/giphy.gif',
    'shipping_enabled': true,
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating xyw_rating--empty">star_border</div><div class="xyw_rating xyw_rating--empty">star_border</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  },
  'ugc_test4': {
    'image_url_custom': 'https://1.bp.blogspot.com/-wSF0agAogAk/WY13OVqRXlI/AAAAAAAAFcs/7hB0FqOXnbk42wx5MpbTPmCU_7XtCo2xwCLcBGAs/s640/ezgif.com-video-to-gif%2B%25282%2529.gif',
    'image_url_custom_hover': 'https://daks2k3a4ib2z.cloudfront.net/5a03819163f9620001c8ecbe/5a0be2b4ef4a3c00017fc3b4_Tier3GIF_2MB25fps.gif',
    'shipping_enabled': true,
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating xyw_rating--empty">star_border</div><div class="xyw_rating xyw_rating--empty">star_border</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  },

  'ugc_test5': {
    'image_url_custom_hover': 'https://media1.tenor.com/images/8ff42f7fbf752419e1eac624d86033b6/tenor.gif',
    'shipping_enabled': true,
    'youtube': 'https://www.youtube.com/watch?v=fvRkWO5g2HE',
    'rating': '<div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div><div class="xyw_rating">star</div>',
    'array_tags': ['fun', 'daytime', 'child friendly'],
  }
}






//el — новая строка
//already — true/false
function cartAddAnimation1(el, already) {

}

function cartAddDiscount1(q) { //TODO: сделать подсчет скидки более универсальным, передавать не кол-во, а состав корзины
  var discount = 0;
  var offvalue = false;
  return [discount, offvalue];
}





var notiShown = false;

$('[data-shop-kart=\'plural\']').each(function (i, item) {
  item.dataset.originalWord = item.textContent
});

function showCartNoti(thiss) {
  var notiEl = $(':attr(\'^data-kart-noti\')');
  var ixNotiHide = {
    'stepsA': [{
      'opacity': 1,
      'transition': 'transform 200ms ease 0ms, opacity 250ms ease 0ms',
      'x': '0px',
      'y': '80px',
      'z': '0px',
    }],
    'stepsB': []
  };


  if (thiss['q'] > 0) {
    setTimeout(function () {
      ix.run(ixResetXY, notiEl);
    }, 50)
  } else {
    setTimeout(function () {
      ix.run(ixNotiHide, notiEl);
    }, 50)
  }


  //Pluralize
  var $plurals = $('[data-shop-kart=\'plural\']');
  $plurals.each(function (i, item) {
    var word = item.dataset.originalWord || item.textContent;
    if (thiss['q'] > 1) {
      item.textContent = pluralize(word);
    } else {
      item.textContent = word;
    }
  });

}






















var ix_But_addToCart_1 = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
    'x': '-102px',
  }]
};

var ix_But_addToCart_0 = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
    'x': '0px',
  }]
};


var ix_But_addBuy_1 = {
  'stepsA': [{
    'opacity': 0,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
  }]
};

var ix_But_addBuy_0 = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
  }]
};



var kartItemInitialHeight = 130;

var ixKItemAppear = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 100ms ease 0ms, opacity 100ms ease 0ms',
    'height': '130px',
  }]
};



var ixKPlus = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
    'scaleX': 1,
    'scaleY': 1,
    'scaleZ': 1,
    // 'y': '-26px',
  }]
};



var ixKPlus = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
    'scaleX': 1,
    'scaleY': 1,
    'scaleZ': 1,
    // 'y': '-26px',
  }]
};

var ixKMinus = {
  'stepsA': [{
    'opacity': 1,
    'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
    'scaleX': 1,
    'scaleY': 1,
    'scaleZ': 1,
    // 'y': '26px',
  }]
};

var ixKPlusMinusOff = {
  // 'stepsA': [{
  //   'opacity': 0,
  //   'transition': 'transform 200ms ease 0ms, opacity 200ms ease 0ms',
  //   'scaleX': 1,
  //   'scaleY': 1,
  //   'scaleZ': 1,
  //   // 'y': '0px',
  // }]
};



var ix_qChange_1 = {
  'stepsA': [{
    'opacity': 1,
    'scale': 1,
    'transition': 'transform 100ms ease 0ms, opacity 200ms ease 0ms',
  }]
};
var ix_qChange_0 = {
  'stepsA': [{
    'opacity': 1,
    'scale': 1,
    'transition': 'transform 100ms ease 0ms, opacity 200ms ease 0ms',
  }]
};


















qq(true);
function qq(hide) {
  // if (!xsolla) xsolla = new Xsolla(shop);
  if (hide) {
    $('.q').removeClass('shown');
    $('.b').removeClass('xsolla_panel');
    $('.float').removeClass('xsolla_panel');
    return
  }
  $('.q').addClass('shown');
  $('.b').addClass('xsolla_panel');
  $('.float').addClass('xsolla_panel');

}




$(':attr(\'^data-q-close\')').click(function () {
  qq(true)
})


$('.k').removeClass('shown');










// ////////////////////   PANEL   //////////////////////


// var Webflow = Webflow || [];
// var xsolla;
// Webflow.push(function () {
//   xsolla = new Xsolla(shopSettings_YW, addSwiper); //Callback
// });






function popups() {
  console.log('popups');

  require(['xsolla_genericpopups',], function (GenericPopups) {
    window.genericPops = new GenericPopups();
  });

  if (flow === 'authorized') {
    $('.but_main--play').removeClass('hidden');
    $('[data-xpop=\'trigger,xpop_login\']').addClass('hidden');
  } else {
    $('.but_main--play').addClass('hidden');
    $('[data-xpop=\'trigger,xpop_login\']').removeClass('hidden');
  }



  $('[data-xpop=\'trigger,xpop_yw\']').on({
    click: function (evt) {
      evt.stopPropagation();
      // $('.p').addClass('shown');
      // setTimeout(function () {
      //   $('.pb').addClass('shown');
      //   $('.pz').addClass('shown');
      // },10)

      var sku = $(this).closest(':attr(\'^data-idd\')')[0].dataset.idd;

      var but = $('#gameurl')[0];
      // http://yourworld:Games/LiveParks/lakesidetest5
      but.href = (userToken) ? 'yourworld:Games/LiveParks/' + sku + '?username=' + userToken : null;
      console.log('sku = ', sku);
    }
  })


  // $('.but_main--play').on({
  //   click: function (evt) {
  //     evt.stopPropagation();
  //     $('.p').addClass('shown');
  //     setTimeout(function () {
  //       $('.pb').addClass('shown');
  //       $('.pz').addClass('shown');
  //     }, 10)
  //   }
  // });

  // $('.pz, .px').on({
  //   click: function (evt) {
  //     evt.stopPropagation();
  //     $('.pb').removeClass('shown');
  //     $('.pz').removeClass('shown');
  //     setTimeout(function () {
  //       $('.p').removeClass('shown');
  //     }, 200)
  //   }
  // });

}



var userToken = null;

var flow;
function authorizedFlow(o) {
  setEmail(parseJwt(o))
  flow = 'authorized';
  console.log('authorizedFlow');
  $('[data-auth=\'logged\']').removeClass('hidden');
  $('[data-auth=\'unlogged\']').addClass('hidden');
  userToken = o;



  // $('#loginbut').addClass('hidden');
  // $('#logout').removeClass('hidden');

  // $(':attr(\'^data-kart-buy\')').addClass('hidden');
  // $('[data-xpop=\'trigger,xpop_yw\']').removeClass('hidden');

  $("#logout").on("click", function () {
    eraseCookie("xsolla_login_token", null),
      eraseCookie("xsolla_last_click_id", null),
      location.reload()
  });

}

var userI;
function setEmail(userinfo) {
  userI = userinfo['email'];
  $('#useremail').text(userinfo['email']);

}



function unauthorizedFlow() {
  flow = 'unauthorized';

  console.log('unauthorizedFlow');
  $('[data-auth=\'logged\']').addClass('hidden');
  $('[data-auth=\'unlogged\']').removeClass('hidden');
  // $('#loginbut').removeClass('hidden');
  // $('#logout').addClass('hidden');
}


function parseJwt (token) {
  var base64Url = token.split('.')[1];
  var base64 = base64Url.replace('-', '+').replace('_', '/');
  return JSON.parse(window.atob(base64));
};



function getCookie(o) {

  for (var e = o + "=", n = decodeURIComponent(document.cookie).split(";"), t = 0; t < n.length; t++) {
    for (var i = n[t]; " " === i.charAt(0); )
      i = i.substring(1);
    if (0 === i.indexOf(e))
      return i.substring(e.length, i.length)
  }
  return ""
}

function setCookie(o, e) {
  var n = new Date;
  n.setTime(n.getTime() + 864e5);
  var t = "expires=" + n.toUTCString();
  document.cookie = o + "=" + e + ";" + t + ";path=/"
}

function eraseCookie(o) {
  document.cookie = o + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;"
}

function getQueryParams(o) {
  o = o.split("+").join(" ");
  for (var e, n = {}, t = /[?&]?([^=]+)=([^&]*)/g; e = t.exec(o); )
    n[decodeURIComponent(e[1])] = decodeURIComponent(e[2]);
  return n
}


$(document).ready(function() {
  var o;
  window.location.search && (o = getQueryParams(window.location.search).token),
    o ? (setCookie("xsolla_login_token", o),
      window.history.pushState("", "", document.location.pathname)) : o = getCookie("xsolla_login_token"),
    o ? authorizedFlow(o) : unauthorizedFlow();
});













var psInit = null;
// var XPayStationWidget = null;
var yourWorldShop = null;

















{/* <script src="https://cdn.xsolla.net/xsolla-login-widget/sdk/1.3.1/xl.min.js"></script> */}


// XL.init({
//   projectId: '159661db-bcb5-11e8-b036-42010aa80004',
//   loginUrl: 'http://xsolla-yourworld.webflow.io/catalog',
//   locale: 'en_US',
//   onlyWidgets: true,
//   fields: 'email',
//   theme: 'https://cdn.xsolla.net/files/uploaded/43298/ec3454469038c125b49055f620c83a0e.css'
// });


XL.init({
  projectId: '7d6d6c1b-a02c-11e8-ad67-d89d67155224',
  loginUrl: 'https://yourworlds.com/catalog.html',
  locale: 'en_US',
  onlyWidgets: true,
  fields: 'email',
  theme: 'https://cdn.xsolla.net/files/uploaded/43298/ec3454469038c125b49055f620c83a0e.css'
});



var element_id = 'xl_auth';
var options = {
  width: '450px',
  height: '650px',
  route: XL.ROUTES.REGISTRATION
};
XL.AuthWidget(element_id, options);









shopSettings_YW['callbacks']['callbackAfterStore'] = getCookie;
shopSettings_YW['customAttrs'] = yw_custom_attributes; //Custom Pictures and shipping





var dev = true;
var baseURL = dev ? 'http://xsolla.maiik.ru/xsolla_store' : 'https://yourworlds.com/m'; //



requirejs.config({
  // baseUrl: baseURL + '/js/',
  paths: {
    'xsolla_store':                   baseURL + '/js/xsolla_store',
    'xsolla_store_shop':              baseURL + '/js/xsolla_store_shop',
    'xsolla_store_shop_grid':         baseURL + '/js/xsolla_store_shop_grid',
    'xsolla_store_shop_good':         baseURL + '/js/xsolla_store_shop_good',
    'xsolla_store_shop_staticbutton': baseURL + '/js/xsolla_store_shop_staticbutton',
    'xsolla_store_cart':              baseURL + '/js/xsolla_store_cart',
    'xsolla_store_shop_cart_good':    baseURL + '/js/xsolla_store_shop_cart_good',

    'parallax':                       'https://cdnjs.cloudflare.com/ajax/libs/parallax/3.1.0/parallax.min',
    'scrolr':                         'https://cdnjs.cloudflare.com/ajax/libs/skrollr/0.6.30/skrollr.min',
    'xsolla_genericpopups':           'https://cdn.xsolla.net/misc/mikelibs/genericpopups/latest/genericpopups',
    // 'widget.min':                     'https://cdn.xsolla.net/misc/mikelibs/widget/latest/widget',
    // 'widget.min':                     'https://static.xsolla.com/embed/paystation/1.0.7/widget.min',
    '_':                              'https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash',

    'swiper':                         'https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.3.5/js/swiper.min',

    'fragbuilder':                    'https://cdn.xsolla.net/misc/mikelibs/fragbuilder/latest/fragbuilder',
    'require_css':                    'https://cdnjs.cloudflare.com/ajax/libs/require-css/0.1.10/css.min',
    'swiper_css':                     'https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/css/swiper',
    'swiper_css_mike':                baseURL + '/libs/swiper-add',
    // 'yw_css':                      baseURL + 'http://xsolla.maiik.ru/xsolla-yw/css/your_world_new',
  }
});





define([
  '_',
  'xsolla_store',
  // 'parallax',
  // 'skrollr',
  'require_css!swiper_css',
  'require_css!swiper_css_mike',

  // 'require_css!yw_css'
], function (
  _,
  Xsolla,
  // Parallax,
  // skrollr,
  require_css,
  require_css_mike,
  // require_css_yw,
) {



  window.yourWorldShop = new Xsolla(shopSettings_YW);

  // skrollr.init();
  // $('.scene').each(function (i, item) {
  //   var paral = new Parallax(item);
  // })
  // window.addEventListener("load", function () {
  //   SmoothParallax.init();
  // });
  setTimeout(function () {
    popups();
  }, 2000)



  return yourWorldShop;
});

